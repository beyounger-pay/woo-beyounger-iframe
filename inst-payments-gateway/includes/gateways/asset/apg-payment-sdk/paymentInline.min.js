import $ from"jquery";import{sha512}from"js-sha512";import axios from"axios";import QRCode from"qrcode";const CryptoJS=require("crypto-js");export const payInit=function({tradeId:i,userElement:e,url:t,buttonName:s="payButton"}){const o=axios.create({baseURL:t+"/payment/page/v5",timeout:6e4});const c=(e,t)=>{let s=t||"APGPaymentAesKey";const a=CryptoJS.enc.Utf8.parse(s);const l=CryptoJS.AES.encrypt(JSON.stringify(e),a,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return l.toString()};let a=document.getElementsByClassName(e)[0];const n=document.documentElement.clientHeight;const H=document.documentElement.clientWidth;let d="";a.style.position="relative";a.innerHTML=`
  <div class="popup">
  <span class="iconfont iconPosi">&#xe676;</span>
  <iframe frameborder="0"></iframe>
  </div>
  <div id="payModel">
  <div class="payShow">
  <div class="paycard">
  <div class="payHead">
      <input type="radio" class="payRadio creditCard" name="key">
      <div class="paycard-show"> 
      </div>
  </div>
  <div class="payForm">
          <div class="payForm-item">
              <label for="" class="payLabel">Card Number</label>
              <input type="text" placeholder="13 to 19 digits" class="payInput cardNumInp" draggable="true"  maxlength="19">
              <span class="message cardNumMes">Missing card number</span>
              <span class="message erroCardNumMes">Bank card number is not correct</span>
          </div>
          <div class="payForm-item">
              <label for="" class="payLabel">Valid thru</label>
              <div class="payTime">
                  <select required name="" id="" class="paySelect monthSelect">
                      <option selected="selected">MM</option>
                      <option value="01">01</option>
                      <option value="02">02</option>
                      <option value="03">03</option>
                      <option value="04">04</option>
                      <option value="05">05</option>
                      <option value="06">06</option>
                      <option value="07">07</option>
                      <option value="08">08</option>
                      <option value="09">09</option>
                      <option value="10">10</option>
                      <option value="11">11</option>
                      <option value="12">12</option>
                  </select>
                  <select name="" id="" class="paySelectYears paySelect yearSelect">
                      <option selected="selected">YY</option>
                  </select>
              </div>
              <span class="message selectMess">Missing expiry date</span>
          </div>
          <div class="payForm-item">
              <label for="" class="payLabel">Security Code</label>
              <div class="payInput_width"> <input type="text" class="payShortInput payInput codeInp" placeholder="CVV">
              <div class="cicle"></div>
              <div class="tips">
                  <h3>Where can I find it?</h3>
                  <div class="tips_flex">
                  <img
                  src="https://resources.pi-nightly.integration.oscato.com/resource/network/DEMO_SHOP/en/AMEX/code_location.png"
                  alt=""/>
                  <div>
                  The security code is a 4-digit number on the front side of your card
                  </div>
                  </div>
              </div></div>
             
              
              
              <span class="message codeMes">Missing security code</span>
              <span class="message erroeCodeMes">Code for 3 or 4 digits</span>
          </div>
         
         
<div class="seeMore">More</div>
  </div>
</div>

  </div>
  <div class="loading-container">
<svg class="MuiCircularProgress-svg" viewBox="22 22 44 44">
<circle class="MuiCircularProgress-circle" cx="44" cy="44" r="20.2" fill="none" stroke-width="3.6"></circle>
</svg>

</div>
        <div class="paySubmit">
            <button class="payButton">pay</button>
        </div>
        
    </div>`;const p=document.getElementsByClassName("paycard")[0];const V=document.getElementsByClassName("payButton")[0];const Y=document.getElementsByClassName("paySelectYears")[0];const m=document.getElementsByClassName(s)[0];m.style.position="relative";const r=document.getElementsByClassName("popup")[0];const G=document.getElementsByClassName("iconPosi")[0];const u=document.getElementsByClassName("payForm")[0];const K=document.getElementsByClassName("creditCard")[0];const y=document.getElementsByTagName("iframe")[0];const g=document.getElementsByClassName("seeMore")[0];const _=document.getElementsByClassName("payShow")[0];const J=document.getElementsByClassName("loading-container")[0];const h=document.getElementsByClassName("cardNumInp")[0];const W=document.getElementsByClassName("cardNumMes")[0];const Q=document.getElementsByClassName("erroCardNumMes")[0];const f=document.getElementsByClassName("monthSelect")[0];const v=document.getElementsByClassName("yearSelect")[0];const z=document.getElementsByClassName("selectMess")[0];const C=document.getElementsByClassName("codeInp")[0];const X=document.getElementsByClassName("codeMes")[0];const Z=document.getElementsByClassName("erroeCodeMes")[0];const ee=/^[0-9]{13,19}$/;const te=/^4/;const se=/^(5|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)/;const ae=/^2131|1800|352[8-9]|35[3-7][0-9]|358[0-9]/;const le=/^(34|37)/;const ne=/^(36|3095|60|64|65|3[8-9]|30[0-5]|622(1(2[6-9]|[3-9]\d)|[2-8]\d{2}|9([01]\d|2[0-5]))|62400[0-9]|6240[0-9][0-9]|624[0-9]{3}|62[4-5][0-9]{3}|626[0-9]{3}|62820[0-9]|6282[0-9][0-9]|628[2-7][0-9]{2}|6288[0-9]{2})/;let E=false;let b=false;let L=false;const ie=/^\d{3,4}$/;let N=[];const M=[u];let T={};let k="";let B=true;let I=[];const w=["HolderNameInp"];let x=false;let S={};let oe="";if(s!=="payButton"){V.style.display="none"}function q(){if(!h.value){E=false;Q.style.display="none";W.style.display="inline-block";h.classList.add("inputMessage")}else{if(!((te.test(h.value)||se.test(h.value)||ae.test(h.value)||le.test(h.value)||ne.test(h.value))&&ee.test(h.value))){E=false;h.classList.add("inputMessage");W.style.display="none";Q.style.display="inline-block"}else{E=true;h.classList.remove("inputMessage");W.style.display="none";Q.style.display="none";return true}}}function P(){if(f.value!=="MM"&&v.value!=="YY"){b=true;z.style.display="none";f.classList.remove("inputMessage");v.classList.remove("inputMessage");return true}else{b=false;z.style.display="inline-block";f.classList.add("inputMessage");v.classList.add("inputMessage")}}function O(){if(!C.value){L=false;Z.style.display="none";X.style.display="inline-block";C.classList.add("inputMessage")}else{if(ie.test(C.value)){L=true;X.style.display="none";Z.style.display="none";C.classList.remove("inputMessage");return true}else{L=false;C.classList.add("inputMessage");X.style.display="none";Z.style.display="inline-block"}}}let A={};let R={};h.onblur=q;f.onblur=P;v.onblur=P;C.onblur=O;let D="";let U=false;let ce="";let l={};let F=[];const de=new Date;const re=de.getFullYear();for(let e=re;e<re+12;e++){const ve=document.createElement("option");ve.value=e;ve.innerText=e;Y.appendChild(ve)}function pe(){U=true;if(!h.value){alert("Please input the card number");D=""}else{if(te.test(h.value)){D="visa"}if(se.test(h.value)){D="master"}if(ae.test(h.value)){D="jcb"}if(le.test(h.value)){D="ae"}if(ne.test(h.value)){D="dc"}}const d=l[D];if(d){delete d.cardNo;delete d.expiryMonth;delete d.expiryYear;delete d.icon;delete d.securityCode;A=d;if(Object.keys(d).length){const r=document.createElement("div");r.classList.add("dynamicForm");g.style.display="none";Object.keys(d).forEach(s=>{const e=document.createElement("div");e.classList.add("payForm-item");const t=document.createElement("label");t.classList.add("payLabel");t.innerText=d[s].title;if(s==="accountType"){const a=document.createElement("select");if(d[s].isRequired==1){a.required="required"}a.classList.add("payInput");a.classList.add(s+"Inp");const l=document.createElement("option");const n=document.createElement("option");const i=document.createElement("option");l.selected="selected";l.innerText=d[s].placeholder;n.value="0";n.innerText="CHECKING";i.value="1";i.innerText="SAVINGS";a.appendChild(l);a.appendChild(n);a.appendChild(i);const o=document.createElement("span");o.classList.add(s+"Mes");o.classList.add("message");e.appendChild(t);e.appendChild(a);e.appendChild(o);r.appendChild(e);u.appendChild(r)}else if(s==="deviceCryptFormat"){const a=document.createElement("select");if(d[s].isRequired==1){a.required="required"}a.classList.add("payInput");a.classList.add(s+"Inp");const l=document.createElement("option");const n=document.createElement("option");const i=document.createElement("option");l.selected="selected";l.innerText=d[s].placeholder;n.value="0";n.innerText="3DSECURE ";i.value="1";i.innerText="EMV";a.appendChild(l);a.appendChild(n);a.appendChild(i);const o=document.createElement("span");o.classList.add(s+"Mes");o.classList.add("message");e.appendChild(t);e.appendChild(a);e.appendChild(o);r.appendChild(e);u.appendChild(r)}else if(s==="p2peEncryptState"){const a=document.createElement("select");if(d[s].isRequired==1){a.required="required"}a.classList.add("payInput");a.classList.add(s+"Inp");const l=document.createElement("option");const n=document.createElement("option");const i=document.createElement("option");l.selected="selected";l.innerText=d[s].placeholder;n.value="0";n.innerText="INVALID";i.value="1";i.innerText="VALID";a.appendChild(l);a.appendChild(n);a.appendChild(i);const o=document.createElement("span");o.classList.add(s+"Mes");o.classList.add("message");e.appendChild(t);e.appendChild(a);e.appendChild(o);r.appendChild(e);u.appendChild(r)}else if(s==="pinEncryptState"){const a=document.createElement("select");if(d[s].isRequired==1){a.required="required"}a.classList.add("payInput");a.classList.add(s+"Inp");const l=document.createElement("option");const n=document.createElement("option");const i=document.createElement("option");l.selected="selected";l.innerText=d[s].placeholder;n.value="0";n.innerText="INVALID";i.value="1";i.innerText="VALID";a.appendChild(l);a.appendChild(n);a.appendChild(i);const o=document.createElement("span");o.classList.add(s+"Mes");o.classList.add("message");e.appendChild(t);e.appendChild(a);e.appendChild(o);r.appendChild(e);u.appendChild(r)}else if(s==="storedOnFile"){const a=document.createElement("select");if(d[s].isRequired==1){a.required="required"}a.classList.add("payInput");a.classList.add(s+"Inp");const l=document.createElement("option");const n=document.createElement("option");const i=document.createElement("option");const c=document.createElement("option");l.selected="selected";l.innerText=d[s].placeholder;n.value="0";n.innerText="NOT_STORED";i.value="1";i.innerText="STORED";c.value="3";c.innerText="TO_BE_STORED";a.appendChild(l);a.appendChild(n);a.appendChild(i);a.appendChild(c);const o=document.createElement("span");o.classList.add(s+"Mes");o.classList.add("message");e.appendChild(t);e.appendChild(a);e.appendChild(o);r.appendChild(e);u.appendChild(r)}else{const a=document.createElement("input");a.type="text";if(d[s].isRrquired==1){a.required="required"}a.classList.add("payInput");a.classList.add(s+"Inp");a.placeholder=d[s].placeholder;const o=document.createElement("span");o.innerText="Missing"+s;o.classList.add(s+"Mes");o.classList.add("message");e.appendChild(t);e.appendChild(a);e.appendChild(o);r.appendChild(e);u.appendChild(r)}const a=document.getElementsByClassName(s+"Inp")[0];a.onblur=function(){const e=new RegExp(A[s].regulation);const t=document.getElementsByClassName(s+"Mes")[0];if(a){if(a.tagName==="SELECT"){if(a.value=="0"||a.value=="1"||a.value=="3"){F.push(true);t.style.display="none";a.classList.remove("inputMessage")}else{F.push(false);t.innerText=A[s].errorMes;t.style.display="inline-block";a.classList.add("inputMessage")}}else{if(!a.value){F.push(false);t.innerText=A[s].isEmptyMes;t.style.display="inline-block";a.classList.add("inputMessage")}else{if(!e.test(a.value)){F.push(false);t.innerText=A[s].errorMes;t.style.display="inline-block";a.classList.add("inputMessage")}else{F.push(true);t.style.display="none";a.classList.remove("inputMessage")}}}}}})}else{U=true;g.style.display="none"}}}g.onclick=pe;h.oninput=function(){A={};U=false;const e=document.getElementsByClassName("dynamicForm")[0];if(e){D="";u.removeChild(e)}g.style.display="inline-block";if(te.test(h.value)){D="visa"}if(se.test(h.value)){D="master"}if(ae.test(h.value)){D="jcb"}if(le.test(h.value)){D="ae"}if(ne.test(h.value)){D="dc"}const t=l[D];if(t){delete t.cardNo;delete t.expiryMonth;delete t.expiryYear;delete t.icon;delete t.securityCode;A=t}};V.onclick=async function(){F=[];if(K.checked){q();P();O();Object.keys(A).forEach(e=>{const t=document.getElementsByClassName(e+"Inp")[0];const s=new RegExp(A[e].regulation);const a=document.getElementsByClassName(e+"Mes")[0];if(t){if(t.tagName==="SELECT"){if(t.value=="0"||t.value=="1"||t.value=="3"){F.push(true);a.style.display="none";t.classList.remove("inputMessage")}else{F.push(false);a.innerText=A[e].errorMes;a.style.display="inline-block";t.classList.add("inputMessage")}}else{if(!t.value){F.push(false);a.innerText=A[e].isEmptyMes;a.style.display="inline-block";t.classList.add("inputMessage")}else{if(!s.test(t.value)){F.push(false);a.innerText=A[e].errorMes;a.style.display="inline-block";t.classList.add("inputMessage")}else{F.push(true);a.style.display="none";t.classList.remove("inputMessage")}}}}});me()}if(x){w.forEach(e=>{console.log(e);console.log(S);const t=e.slice(0,e.length-3);console.log(t);const s=document.getElementsByClassName(e)[0];const a=document.getElementsByClassName(t+"Mes")[0];if(s){if(!s.value){F.push(false);a.style.display="inline-block";s.classList.add("inputMessage")}else{if(!s.value){F.push(false);a.style.display="inline-block";s.classList.add("inputMessage")}else{if(e=="HolderNameInp"){F.push(true);a.style.display="none";s.classList.remove("inputMessage")}else{if(S.requiredParam[t].regulation){const l=new RegExp(S.requiredParam[t].regulation);if(!l.test(s.value)){F.push(false);a.innerText=S.requiredParam[t].errorMes;a.style.display="inline-block";s.classList.add("inputMessage")}else{F.push(true);a.style.display="none";s.classList.remove("inputMessage")}console.log(S.requiredParam[t])}else{F.push(true);a.style.display="none";s.classList.remove("inputMessage")}}}}}});ue()}};async function me(){const e=sha512(i);if(U){console.log(q(),P(),O());if(q()&&P()&&O()&&F.every(e=>e==true)){try{const t={};if(Object.keys(A).length){Object.keys(A).forEach(e=>{t[e]=document.getElementsByClassName(e+"Inp")[0].value})}m.disabled="disabled";m.classList.add("loading");const{data:s}=await o.post(`/pay`,{tradeId:i,securityOne:c(h.value,"APGPaymentAesKey"),securityTwo:c(f.value,"APGPaymentAesKey"),securityThree:c(v.value,"APGPaymentAesKey"),securityFour:c(C.value,"APGPaymentAesKey"),payType:ce,paySign:e,...t});if(s.code===200&&s.status===1){console.log(Object.keys(A).length,"02356");if(s.data.challengeUrl){if(Object.keys(A).length){if(E&&b&&L&&F.every(e=>e===true)&&F.length){D="";F=[];A={};const a=sha512(s.data.merchantNo+i+s.data.referenceNo+s.data.merOrderNo+s.data.challengeUrl);if(a===s.data.pay3DSSign){const l=document.getElementsByClassName("dynamicForm")[0];if(l){u.removeChild(l);g.style.display="inline-block"}y.src=s.data.challengeUrl;r.style.display="inline-block";m.removeAttribute("disabled");m.classList.remove("loading");d=setInterval(async()=>{await j()},2e3)}else{alert("Data inconsistency")}}else if(!F.length){alert("Please click to see more")}}else{if(E&&b&&L){D="";F=[];A={};const a=sha512(s.data.merchantNo+i+s.data.referenceNo+s.data.merOrderNo+s.data.challengeUrl);if(a===s.data.pay3DSSign){const l=document.getElementsByClassName("dynamicForm")[0];if(l){u.removeChild(l);g.style.display="inline-block"}y.src=s.data.challengeUrl;r.style.display="inline-block";d=setInterval(async()=>{await j()},2e3)}else{alert("Data inconsistency")}}}}else{if(Object.keys(A).length){if(E&&b&&L&&F.every(e=>e===true)&&F.length){D="";F=[];A={};const n=sha512(s.data.merchantNo+i+s.data.referenceNo+s.data.merOrderNo+(s.data.returnUrl||s.data.cancelUrl));if(n===s.data.payResultSign){const l=document.getElementsByClassName("dynamicForm")[0];if(l){u.removeChild(l);g.style.display="inline-block";A={}}if(s.data.returnUrl){window.location.replace(s.data.returnUrl)}else{window.location.href=s.data.cancelUrl}}else{m.removeAttribute("disabled");m.classList.remove("loading");alert("Data inconsistency")}}else if(!F.length){m.removeAttribute("disabled");m.classList.remove("loading");alert("Please click to see more")}}else{if(E&&b&&L){D="";F=[];A={};const n=sha512(s.data.merchantNo+i+s.data.referenceNo+s.data.merOrderNo+(s.data.returnUrl||s.data.cancelUrl));if(n===s.data.payResultSign){const l=document.getElementsByClassName("dynamicForm")[0];if(l){u.removeChild(l);g.style.display="inline-block"}if(s.data.returnUrl){window.location.replace(s.data.returnUrl)}else{window.location.href=s.data.cancelUrl}}else{m.removeAttribute("disabled");m.classList.remove("loading");alert("Data inconsistency")}}}}}else{m.removeAttribute("disabled");m.classList.remove("loading");alert(s.data.errorMsg.errorDesc)}}catch(e){m.removeAttribute("disabled");m.classList.remove("loading");alert(e)}}}else{m.removeAttribute("disabled");m.classList.remove("loading");alert("Please click to see more")}}async function ue(){if(F.every(e=>e==true)){try{const t={};if(Object.keys(R||{}).length){Object.keys(R).forEach(e=>{t[e]=document.getElementsByClassName(e+"Inp")[0].value})}const e=document.getElementsByClassName("HolderNameInp")[0];console.log(S,"pproTypeNow");const s=sha512(i);m.disabled="disabled";m.classList.add("loading");const{data:a}=await o.post(`/pay`,{tradeId:i,pproTradeType:S.tradeType,pproTradeTypeTag:S.tradeTypeTag,countryCode:S.countryCode,payType:"PPRO",paySign:s,accountHolderName:e.value,...t});console.log(a);if(a.code===200&&a.status===1){if(a.data.challengeUrl){const l=document.getElementsByClassName("dynamicForm")[0];if(l){u.removeChild(l);g.style.display="inline-block"}y.src=a.data.challengeUrl;r.style.display="inline-block";m.removeAttribute("disabled");m.classList.remove("loading");d=setInterval(async()=>{await j()},2e3)}else{alert("Transaction failure")}}else{m.removeAttribute("disabled");m.classList.remove("loading");alert(a.data.errorMsg.errorDesc)}}catch(e){m.removeAttribute("disabled");m.classList.remove("loading");alert(e)}}}G.onclick=async function(){U=false;r.style.display="none";g.style.display="inline-block";clearInterval(d)};K.onclick=function(){if(K.checked){clearInterval(k);B=true;x=false;F=[];ce="CREDITCARD";const e=document.getElementsByClassName("wechatLoding")[0];if(e)e.style.display="none";M.forEach(e=>{e.style.display="none"});u.style.display="inline-block";m.removeAttribute("disabled");m.classList.remove("loading")}};const ye="#999";const ge="#333";$(function(){$("select").css("color",ye);$("option").css("color",ge);$("select").change(function(){var e=$(this).val();if(e==$(this).find("option:first").val()){$(this).css("color",ye)}else{$(this).css("color",ge)}})});(async function(){try{_.style.display="none";J.style.display="block";const{data:r}=await o.post("/pay/payTypes",{tradeId:i});if(r.code===200&&r.status===1){const e=sha512(r.data.merchantNo+r.data.integration+r.data.merOrderNo);if(e===r.data.payTypeSign){_.style.display="block";J.style.display="none";T=r.data;console.log(T,navigator.language,"initData");l=r.data.payType.creditCard.cardType;const t=Object.keys(r.data.payType);N=t.filter(e=>e!=="creditCard");console.log(N,"supportPay");const a=document.getElementsByClassName("paycard-show")[0];Object.keys(l).forEach(e=>{const t=document.createElement("div");const s=document.createElement("img");t.className="itemCard";s.src=l[e].icon.title;t.appendChild(s);a.appendChild(t)});N.forEach(t=>{if(t==="wechat"){const a=document.createElement("div");a.classList.add("payHead");const s=document.createElement("input");s.type="radio";s.classList.add("payRadio",t);s.name="key";a.appendChild(s);const e=document.createElement("div");e.classList.add("paycard-show");const l=document.createElement("img");l.src=r.data.payType[t].icon;l.style.width="30px";l.style.objectFit="cover";e.appendChild(l);a.appendChild(e);p.appendChild(a);if(T.payCurrency!=="HKD"){a.style.display="none";return}const n=document.createElement("div");n.classList.add(t+"Style");const i=document.createElement("img");i.classList.add("wechatImg");i.src=require("../payment-sdk/assets/images/qrCode.png");const o=document.createElement("img");o.classList.add("wechatIcon");o.src=require("../payment-sdk/assets/images/wechatIcon.png");n.appendChild(i);n.appendChild(o);p.appendChild(n);const c=document.createElement("div");c.classList.add("wechatLoding");c.innerHTML=`<div class="loading-container">

            <svg class="MuiCircularProgress-svg" viewBox="22 22 44 44">

            <circle class="MuiCircularProgress-circle" cx="44" cy="44" r="20.2" fill="none" stroke-width="3.6"></circle>

            </svg>

            

            </div>`;p.appendChild(c)}if(t==="pproType"){console.log(T);if(T.payType.pproType){I=(T.payType.pproType[T.countryName]||[]).filter(e=>{return e.currency.includes(T.payCurrency)})}console.log(I);const a=document.createElement("div");a.classList.add("payHead");const s=document.createElement("div");s.classList.add("paycard-show");I.forEach(e=>{const t=document.createElement("img");t.style.width="40px";t.style.objectFit="cover";t.src=e.icon;t.classList.add(e.tradeTypeTag,"pproImg");s.appendChild(t)});a.appendChild(s);p.appendChild(a);const n=document.createElement("div");n.classList.add(t+"Style");const d=`  <div class="payForm-item">
            <label for="" class="payLabel">accountHolderName</label>
            <input  class="payInput HolderNameInp" draggable="true" >
            <span class="message HolderNameMes">Missing accountHolderName</span>
        </div>`;n.innerHTML=d;p.appendChild(n)}const e=document.getElementsByClassName(t+"Style")[0];M.push(e)});N.forEach(o=>{if(o==="pproType"){I.forEach((e,i)=>{const l=document.getElementsByClassName(e.tradeTypeTag)[0];l.onclick=async function(){x=true;F=[];m.removeAttribute("disabled");m.classList.remove("loading");const e=document.getElementsByClassName("payRadio");Array.from(e).forEach(e=>{e.checked=false});const t=document.getElementsByClassName("payForm")[0];t.style.display="none";M.forEach(e=>{if(e)e.style.display="none"});const n=document.getElementsByClassName("divbox")[0];if(n){n.remove()}const s=document.getElementsByClassName("pproTypeStyle")[0];if(I[i].requiredParam){const n=document.createElement("div");n.classList.add("divbox");Object.keys(I[i].requiredParam).forEach(e=>{w.push(e+"Inp");console.log(w);const t=document.createElement("div");t.classList.add("payForm-item");const s=document.createElement("label");s.classList.add("payLabel");s.innerText=e;const a=document.createElement("input");a.required="required";a.classList.add("payInput");a.classList.add(e+"Inp");if(I[i].requiredParam[e].placeholder){a.placeholder=I[i].requiredParam[e].placeholder}const l=document.createElement("span");l.innerText="Missing "+e;l.classList.add(e+"Mes");l.classList.add("message");t.appendChild(s);t.appendChild(a);t.appendChild(l);n.appendChild(t)});s.appendChild(n)}s.style.display="inline-block";S=I[i];R=S.requiredParam;he();console.log(R,"pproOtherForm");console.log(S);console.log("111");clearInterval(k);if(l.checked&&B){t.style.display="none";M.forEach(e=>{if(e)e.style.display="none"});if(o==="wechat"){const a=document.getElementsByClassName("wechatLoding")[0];a.style.display="block";if(B){await fe()}}else if(o==="pproType"){const s=document.getElementsByClassName("pproTypeStyle")[0];s.style.display="block";clearInterval(k);B=true;const a=document.getElementsByClassName("wechatLoding")[0];if(a)a.style.display="none"}else{clearInterval(k);B=true;const a=document.getElementsByClassName("wechatLoding")[0];if(a)a.style.display="none"}N.forEach(e=>{const t=document.getElementsByClassName(e)[0]});t.style.display="none";m.disabled="disabled"}}});return}const s=document.getElementsByClassName(o)[0];console.log(o);s.onclick=async function(){clearInterval(k);x=false;if(s.checked&&B){u.style.display="none";M.forEach(e=>{if(e)e.style.display="none"});if(o==="wechat"){const e=document.getElementsByClassName("wechatLoding")[0];e.style.display="block";if(B){await fe()}}else if(o==="pproType"){const t=document.getElementsByClassName("pproTypeStyle")[0];t.style.display="block";clearInterval(k);B=true;const e=document.getElementsByClassName("wechatLoding")[0];if(e)e.style.display="none"}else{clearInterval(k);B=true;const e=document.getElementsByClassName("wechatLoding")[0];if(e)e.style.display="none"}N.forEach(e=>{const t=document.getElementsByClassName(e)[0]});u.style.display="none";m.disabled="disabled"}}})}else{alert("Data inconsistency")}}else{alert(r.data.errorMsg.errorDesc)}}catch(e){alert(e)}})();async function j(){try{const{data:t}=await o.get(`/3dsresult/${i}`);if(t.code===200&&t.status===1){let e="";e=sha512(t.data.merchantNo+i+t.data.referenceNo+t.data.merOrderNo+t.data.returnUrl);if(t.data.tradeResult==="Succeed"){e=sha512(t.data.merchantNo+i+t.data.referenceNo+t.data.merOrderNo+t.data.returnUrl);console.log(e,"pay3dsResultSign");if(e===t.data.pay3dsResultSign){y.src=t.data.returnUrl;r.style.display="inline-block";clearInterval(d);clearInterval(k);G.style.display="none"}else{alert("Data inconsistency")}}if(t.data.tradeResult==="Failed"){e=sha512(t.data.merchantNo+i+t.data.referenceNo+t.data.merOrderNo+t.data.cancelUrl);console.log(e);if(e===t.data.pay3dsResultSign){y.src=t.data.cancelUrl;r.style.display="inline-block";clearInterval(d);clearInterval(k);G.style.display="inline-block"}else{alert("Data inconsistency")}}}}catch(e){alert("The request failed")}}(function(){r.style.width=H+"px";r.style.height=n+"px"})();function he(){w.forEach(s=>{const a=s.slice(0,s.length-3);const l=document.getElementsByClassName(s)[0];console.log(l,s);if(!l)return;l.onblur=function(){const e=document.getElementsByClassName(a+"Mes")[0];console.log(e);if(l){if(!l.value){F.push(false);e.style.display="inline-block";l.classList.add("inputMessage")}else{if(!l.value){F.push(false);e.style.display="inline-block";l.classList.add("inputMessage")}else{if(s=="HolderNameInp"){F.push(true);e.style.display="none";l.classList.remove("inputMessage")}else{if(S.requiredParam[a].regulation){const t=new RegExp(S.requiredParam[a].regulation);if(!t.test(l.value)){F.push(false);e.innerText=S.requiredParam[a].errorMes;e.style.display="inline-block";l.classList.add("inputMessage")}else{F.push(true);e.style.display="none";l.classList.remove("inputMessage")}console.log(S.requiredParam[a])}else{F.push(true);e.style.display="none";l.classList.remove("inputMessage")}}}}}}})}window.onresize=function(){const e=document.documentElement.clientHeight;const t=document.documentElement.clientWidth;r.style.width=t+"px";r.style.height=e+"px"};async function fe(){clearInterval(k);B=false;const e=document.getElementsByClassName("wechatLoding")[0];const t=document.getElementsByClassName("wechatStyle")[0];try{const s=sha512(i);const{data:a}=await o.post(`/pay`,{tradeId:i,payType:"NATIVE",paySign:s});if(a.status===1&&a.code===200){e.style.display="none";t.style.display="flex";const l=document.getElementsByClassName("wechatImg")[0];const n=await QRCode.toDataURL(a.data.codeUrl);l.src=n;k=setInterval(async()=>{await j()},2e3)}else{alert(a.data.errorMsg.errorDesc)}}catch(e){alert(e)}}};export const clickButton=function(){const e=document.getElementsByClassName("payButton")[0];e.click()};